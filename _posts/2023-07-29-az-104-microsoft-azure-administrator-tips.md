---
layout: post
title: az-104-microsoft-azure-administrator-tips
date: 2023-07-29 00:12:05
---

- azure的网络安全组(nsg)和其应用的虚拟网络(vnet)必须位于同一个区域，不同区域的nsg和vnet间是无法直接关联的，这是由于数据中心的物理位置和数据延迟等因素决定的，以确保网络性能和安全性

- 想要通过域名访问你的私有ip，可以创建一个私有dns zone如name.com，然后在dns zone中创建一个a记录app.name.com指向私有ip，然后可以使用app.name.com访问你的私有ip

- 创建aks时，kubenet为每个节点分配私有ip，azure cni为每个pod分配私有ip

- application insights是azure的一种应用性能管理服务，能够提供实时的应用程序监控和诊断。它可以监控应用程序的性能，捕获和分析请求、异常、日志和应用程序的跟踪信息，帮助你快速检测和诊断应用程序中的问题

- vm的网络接口上配置的dns会覆盖vnet级别的dns，优先使用网络接口上配置的dns

- 即使没有关联到任何资源，azure仍会对静态公共ip地址和标准负载均衡器及其配置的规则收费，虚拟网络本身是免费的，只有跨区域数据传输会产生费用，已经停止的虚拟机不会产生计算费用，但与其关联的存储和公共ip等资源仍会产生费用，没有使用的网络接口本身不会产生费用

- "ip flow verify"工具能够帮助你确定从虚拟机进出的流量是否被允许或阻止。这个工具可以用来测试如果包从源ip地址到目的地ip地址是否会被允许或阻止。所以，它是一个非常有用的工具，可以用来理解网络安全组(nsg)和防火墙规则是否按照预期在虚拟机上运行

- nsg规则的应用是基于优先级的，数字越小，优先级越高。nsg是有状态的服务，当一个请求从外部发送到虚拟机（入站请求），nsg会记录这个连接。那么，当来自虚拟机的响应（出站请求）回复给请求方时，nsg会识别这个响应是属于一个已经被允许的入站连接的一部分，因此即使出站规则默认是拒绝的，这个出站响应也会被允许通过

- azcopy命令可以将s3 bucket复制到azure storage container，例如：azcopy copy 'https://s3.amazonaws.com/mys3bucket' 'https://consiliumdata.blob.core.windows.net/container1' --recursive=true

- 关于azure subscription

```
在azure中，订阅（subscription）是一个逻辑单位，它用于为使用azure的服务进行计费。你可以在一个订阅下创建、使用和管理azure资源。每个订阅都与一个azure帐户关联，并由azure帐户的所有者或服务管理员进行管理。

订阅的主要功能包括：

1) 提供对azure产品和服务的访问。当你创建一个订阅时，你获得了访问和使用azure服务的权限。
2) 提供计费的基础。azure的所有使用费都是基于订阅的。你可以为每个订阅设置不同的付款方法，例如信用卡、发票支付等。
3) 提供管理边界。你可以使用订阅来组织和控制对azure资源的访问。你可以为每个订阅设置不同的访问策略和权限。
```

- 关于expressroute

```
expressroute是microsoft azure提供的一种服务，允许你在你的本地网络和azure之间创建一条私有连接。这条连接并不经过公共互联网，因此可以提供更高的带宽、更低的延迟，以及更稳定的网络性能。

这是通过与微软的联网合作伙伴（如电信服务提供商）一起工作实现的。这些合作伙伴在全球范围内都有数据中心，并且这些数据中心与azure的数据中心直接连接。当你购买expressroute服务时，你的本地网络会连接到这些数据中心，然后通过它们与azure进行通信。

expressroute也提供了其他一些特性，包括：

专用连接：由于不通过公共互联网，所以可以避免与其他网络流量的竞争，提供更高的网络性能。

安全性：虽然expressroute本身不提供数据加密，但由于它是一种私有连接，因此在一定程度上提高了数据的安全性。如果需要更高级别的安全性，你可以在expressroute连接上设置vpn隧道，以加密数据。

可靠性：expressroute提供了服务级别协议（sla），保证了99.9%的可用性。

总的来说，如果你需要在azure和本地网络之间传输大量数据，或者需要非常高的网络性能和稳定性，expressroute可能是一个很好的选择。
```

- 关于p2s和s2s

```
点到站（point-to-site, p2s）vpn：这是一种vpn连接方式，其中单个设备（例如，远程工作的员工的笔记本电脑或家庭办公室的台式机）会连接到特定的网络或站点，如公司的企业网络。在azure环境中，这通常意味着单个设备（点）会连接到azure虚拟网络（站点）。这种连接方式使用的是安全的隧道协议，例如sstp（安全套接字隧道协议）或ikev2。点到站vpn不需要任何特殊的设备或vpn设备，因为连接是直接从用户设备（例如pc或笔记本）到azure虚拟网络建立的。

站点到站点（site-to-site, s2s）vpn：这是一种vpn连接方式，其中一个完整的网络（例如，一个公司的整个办公室或一个分支机构）会连接到另一个网络或站点，例如云环境。在azure环境中，这可能意味着公司的整个本地网络（站点）连接到azure虚拟网络（站点）。站点到站点vpn需要一个vpn设备（可能是物理设备或软件设备），该设备在本地网络中创建一个vpn隧道到azure的vpn网关。通过这种方式，网络中的所有设备都可以通过vpn访问azure虚拟网络，就好像它们都直接连接到虚拟网络一样。

简单来说，点到站vpn是单个设备到网络的连接，而站点到站点vpn是整个网络到另一个网络的连接。
```
