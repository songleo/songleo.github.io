---
layout: post
title: ocp4.3配置htpasswd用户
date: 2020-07-20 12:12:05
---

## 配置htpasswd用户

```
$ yum install httpd-tools -y
$ htpasswd -c -B -b /share/util/users.htpasswd viewer admin
Adding password for user viewer
$ htpasswd -B -b /share/util/users.htpasswd admin admin
Adding password for user admin
$ cat users.htpasswd
viewer:$2y$05$cjmKG0RCgfFKj4H4jjZ.uOM/1BuD2WBnnG16ddgTz5xCcoM27p1bm
admin:$2y$05$qV5P1MGVrjaR7yVI/8etkei2.C8tH4H./Hn2sT/93R0jIyid4Hfr2

$oc create secret generic ssli-htpass-secret --from-file=htpasswd=/share/util/users.htpasswd -n openshift-config
secret/ssli-htpass-secret created

$ oc apply -f htpasswd-cr.yaml
```

## htpasswd-cr.yaml如下：

```
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: my_htpasswd_provider
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: ssli-htpass-secret
```

## 使用新用户登陆

```
$ oc login -u viewer -p admin
$ oc login -u admin -p admin
$ oc whoami
```
